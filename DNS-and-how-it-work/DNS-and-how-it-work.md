# DNSと、その動作

## DNSとは?
- **DNS(Domain Name System)** は、ドメイン名(ホスト名)とIPアドレスで名前解決を行う機能、サーバ
- OSI参照モデルの  **7層 アプリケーション層**

## 名前解決...?
  - 人間がIPアドレス(例_123.4.5.0)だけで通信を行いたい対象のホストを識別するのは困難...
  - そのホストに識別を人間にわかりやすくするために、IPアドレスとドメイン名(ホスト名)の関連付けを行うことを *名前解決* という

### ざっくり名前解決の例
- まず、インターネット上のサイトを参照したい場合前項でもまとめたように  
  ブラウザのアドレス欄に参照したいサイトの **URL** を入力する(例_`www.example.co.jp`)
  - URLには接続先のホスト名が含まれている
- このURLの代わりに対象ホストのIPアドレスを入力してもサイトを参照することができる
- 上記の2つによりホスト名とIPアドレスが関連付けられて名前解決が行われているということ
  - アドレス欄にあるサイトの `www.example.co.jp` と入力するのと、  
    そのサイトのIPアドレス **123.4.5.0** を入力するのは同じということ

この名前解決を、昔はホスト名とIPアドレスの関連を記述したテキストファイルで行っていた。
インターネットが普及しホスト数が増加したことに伴って管理が難しくなり、DNSが誕生した

## DNSの仕組み

### ドメイン名とホスト名
- IPアドレスに対応した人間にわかるようにしたWebページの名前が ``https://www.example.co.jp`` だとすると、 **www** がホスト名、
  **example.co.jp** がドメイン名
  - ドメイン名はインターネット上のネットワークを特定するもの(インターネット上の住所)
    - ドメインはドットでレベルごとに区切られていて、一番右の `jp` がトップレベルドメイン(TLD) `co`が第２ `sample`が第3
    - トップレベルドメインにも種類が2つあり、`.com, .netなど` 世界中どこでも利用できるものは **gTLD**、国によって分かれるものが **ccTLD**
  - ドメイン名については事項でもくわしくやるよ 
  - ホスト名は、ネットワーク上のコンピュータ、サーバ...などの機器につけられた名前
    - 255文字以内、a〜z, 0〜1の英数字、大文字小文字は無視　という制約がある

### FQDN
- **Fully Qualified Domain Name**(完全修飾ドメイン名)の略
  - ホスト名とドメイン名を省略せずに繋げて記述したもの
    - 例えば、 `ホスト名: www` と `ドメイン名: example.co.jp` を繋げた `www.example.co.jp` のこと
  - インターネット上の特定のコンピュータを指す場合が多い

### DNSの流れ

1. DNSサーバに問い合わせをするためのサーバを用意する　
    - ルートサーバのIPアドレスが書かれた表を予め準備したサーバ
2. 問い合わせを行うためのサーバは、組織内の他の機器（クライアント）からの依頼を受ける
3. 結果を受け取った問い合わせを行うためのサーバは、ルートサーバに問い合わせを行う
    - `www.example.jp` のIPアドレスを問い合わせる
4. 結果を受け取ったルートサーバは、管理してる位置を知らせるDNSサーバに問い合わせる
    - `www.example.jp`　であれば `.jp`　サーバ
5. 知らせられた管理しているサーバはルートサーバと同様に `4.` のDNSサーバに問い合わせる
    - `www.example.jp`　であれば `example.jp`　サーバ
6. 最終的に問い合わせを受けたDNSサーバがIPアドレスを返す
    - `example.jp` サーバがIPアドレスを返す

*★ このようにDNSサーバはすべての名前空間に対する問い合わせ(ルートサーバから下位のサーバ）に対応している*

## DNSキャッシュサーバ
- DNSでは、キャッシュサーバという、くり返し同じ問い合わせを防止するために、  
  DNSへの問い合わせで得た結果をキャッシュする仕組みが実装されている場合もある
  - キャッシュが有効な間に同じ内容の問い合わせがあった場合、  
    再度問い合わせをすることなく自分が持っている内容を返す
- フルサービスリゾルバとも言う
